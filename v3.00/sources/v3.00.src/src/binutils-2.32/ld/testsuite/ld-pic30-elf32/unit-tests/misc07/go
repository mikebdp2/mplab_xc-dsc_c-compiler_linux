# process args
vflag=off
while [ $# -gt 0 ]
do
    case "$1" in
        -v)  vflag=on;;
    esac
    shift
done

rm -f t1.o t2.o t3.o t.exe t.map UartOut.txt

cmd="$PIC30_CD/bin/xc16-as -p30F6015 -omf=elf -o t1.o t1.s"
if [ $vflag = "on" ]; then
    echo
    echo "$cmd"
fi
`$cmd`

cmd="$PIC30_CD/bin/xc16-as -p30F6015 -omf=elf -o t2.o t2.s"
if [ $vflag = "on" ]; then
    echo
    echo "$cmd"
fi
`$cmd`

cmd="$PIC30_CD/bin/xc16-as -p30F6015 -omf=elf -W -o t3.o t3.s"
if [ $vflag = "on" ]; then
    echo
    echo "$cmd"
fi
`$cmd`

cmd="$PIC30_CD/bin/xc16-ld -omf=elf -o t.exe t1.o t2.o t3.o -Map=t.map"
if [ $vflag = "on" ]; then
    echo
    echo "$cmd"
fi
`$cmd`

if [ $vflag = "on" ]; then
    echo
    echo "mdb30.sh -mdb $MDB -cmd run.cmd >sim.out 2>&1"
fi
mdb30.sh -mdb $MDB -cmd run.cmd >sim.out 2>&1

cat UartOut.txt

